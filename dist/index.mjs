import e from"react";const t="undefined"!=typeof EventTarget,r="undefined"!=typeof CustomEvent;class n{listeners=new Set;subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}emit(e){this.listeners.forEach(t=>t(e))}}class o{emitter;constructor(){this.emitter=t&&r?new EventTarget:new n}subscribe(e){if(this.emitter instanceof n)return this.emitter.subscribe(e);const t=this.emitter;return t.addEventListener("change",e),()=>t.removeEventListener("change",e)}emitChange(e){const t={path:e,ts:"undefined"!=typeof performance?performance.now():Date.now()};if(this.emitter instanceof n)return void this.emitter.emit(t);const r=new CustomEvent("change",{detail:t});this.emitter.dispatchEvent(r)}}const s=(e,t)=>{const r="symbol"==typeof t?t.toString():String(t);return e?/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(r)?`${e}.${r}`:`${e}[${JSON.stringify(r)}]`:r},c=(e,t)=>""===e||t===e||t.startsWith(e+"."),i=e=>null!==e&&"object"==typeof e,f=(e,t,r="")=>new Proxy(e,{get:(e,n,o)=>{const c=s(r,n);t.add(c);const i=Reflect.get(e,n,o);return i&&"object"==typeof i&&!0===i[A]?i:i&&"object"==typeof i?f(i,t,c):i}}),a=t=>{const r=new o;for(const[e,n]of Object.entries(t))"function"==typeof n[R]&&n[R](t=>{const n=t&&"detail"in t?t.detail:t,o=(Array.isArray(n?.path)?n.path:[]).map(t=>{const r="symbol"==typeof t?t.toString():String(t);return r?`${e}.${r}`:e});r.emitChange(o)});return{useStore:n=>{const o=e.useRef(n);o.current=n;const s=e.useRef(0),a=e.useRef(-1),u=e.useRef(new Set),l=e.useRef(void 0),y=e.useCallback(()=>{if(a.current===s.current&&void 0!==l.current)return l.current;const e=new Set,r=f(t,e,""),n=o.current(r),c=(y=n,Array.isArray(y)?y.slice():y instanceof Map?new Map(y):y instanceof Set?new Set(y):i(y)?{...y}:y);var y;return u.current=e,a.current=s.current,l.current=c,c},[]);return e.useSyncExternalStore(e=>{return t=t=>{const r=u.current;for(const n of t)for(const t of r)if(c(t,n)||c(n,t))return s.current++,void e()},r.subscribe(e=>{const r=e&&"detail"in e?e.detail:e,n=Array.isArray(r?.path)?r.path:[];t(n)});var t},y,y)}}},u=new WeakMap,l=new WeakMap,y=(e,t)=>(e=>"function"==typeof globalThis[e])(t)&&e instanceof globalThis[t],p=e=>null!=e&&"object"==typeof e&&("function"==typeof e.then||(e instanceof Error||(e instanceof Date||(e instanceof RegExp||(!!y(e,"URL")||(!!y(e,"URLSearchParams")||(!!y(e,"DataView")||(!!y(e,"Blob")||(!!y(e,"File")||(!!y(e,"FormData")||(!!y(e,"WeakMap")||(!!y(e,"WeakSet")||(!!y(e,"Node")||(!!y(e,"Element")||(!!y(e,"Buffer")||(!!y(e,"ArrayBuffer")||(!!y(e,"SharedArrayBuffer")||!!(e=>"undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(e)&&!("undefined"!=typeof DataView&&e instanceof DataView))(e)))))))))))))))))),d=e=>{if(!i(e))return!1;if(l.has(e))return!0;try{return!0===e[A]}catch{return!1}},g=(e,t)=>Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((e,r)=>Object.is(e,t[r])),h=(e,t,r="")=>d(e)?e:i(e)||e instanceof Map||e instanceof Set?p(e)?e:e instanceof Map?b(e,t,r):e instanceof Set?m(e,t,r):w(e,t,r):e,b=(e,t,r="")=>{const n=u.get(e);if(n)return n;const o=(e,n)=>d(e)||p(e)?e:e instanceof Map||e instanceof Set||i(e)?h(e,t,s(r,n)):e,c=new Proxy(e,{get:(e,n,i)=>{if(n===A)return!0;if(n===E)return e;if(n===Symbol.iterator)return function*(){for(const[t,r]of e.entries())yield[t,o(r,t)]};if("entries"===n)return function*(){for(const[t,r]of e.entries())yield[t,o(r,t)]};if("values"===n)return function*(){for(const[t,r]of e.entries())yield o(r,t)};if("forEach"===n)return(t,r)=>e.forEach((e,n)=>t.call(r,o(e,n),n,c));if("get"===n)return t=>o(e.get(t),t);if("set"===n)return(n,i)=>{const f=o(i,n),a=e.get(n);return Object.is(a,f)||(e.set(n,f),t(s(r,n))),c};if("delete"===n)return n=>{const o=e.has(n),c=e.delete(n);return c&&o&&t(s(r,n)),c};if("clear"===n)return()=>{0!==e.size&&(e.clear(),t(r))};const f=Reflect.get(e,n,i);return"function"==typeof f?f.bind(e):f}});return u.set(e,c),l.set(c,e),c},m=(e,t,r="")=>{const n=u.get(e);if(n)return n;const o=e=>d(e)||p(e)?e:e instanceof Map||e instanceof Set||i(e)?h(e,t,r):e,s=new Proxy(e,{get:(e,n,c)=>{if(n===A)return!0;if(n===E)return e;if(n===Symbol.iterator)return function*(){for(const t of e.values())yield o(t)};if("forEach"===n)return(t,r)=>e.forEach(e=>t.call(r,o(e),o(e),s));if("add"===n)return n=>{const c=o(n);return e.has(c)||(e.add(c),t(r)),s};if("delete"===n)return n=>{const o=e.delete(n);return o&&t(r),o};if("clear"===n)return()=>{0!==e.size&&(e.clear(),t(r))};const i=Reflect.get(e,n,c);return"function"==typeof i?i.bind(e):i}});return u.set(e,s),l.set(s,e),s},w=(e,t,r="")=>{if(!i(e))return e;const n=u.get(e);if(n)return n;const o=new Proxy(e,{get:(e,n,o)=>{if(n===A)return!0;if(n===E)return e;const c=Reflect.get(e,n,o);if(d(c))return c;const f=s(r,n);return p(c)?c:c instanceof Map||c instanceof Set||i(c)?h(c,t,f):c},set:(e,n,o,c)=>{const f=Reflect.get(e,n,c);if(Object.is(f,o))return!0;if(g(f,o))return!0;const a=s(r,n),u=d(o)?o:o instanceof Map||o instanceof Set?h(o,t,a):p(o)?o:i(o)?h(o,t,a):o,l=Reflect.set(e,n,u,c);return l&&t(a),l},defineProperty:(e,n,o)=>{const c=s(r,n),f={...o};if("value"in f){const r=Reflect.getOwnPropertyDescriptor(e,n)?.value,o=f.value;if(Object.is(r,o))return!0;if(g(r,o))return!0;f.value=d(o)?o:o instanceof Map||o instanceof Set?h(o,t,c):p(o)?o:i(o)?h(o,t,c):o}const a=Reflect.defineProperty(e,n,f);return a&&t(c),a},deleteProperty:(e,n)=>{const o=Reflect.deleteProperty(e,n);return o&&t(s(r,n)),o},has:(e,t)=>Reflect.has(e,t),ownKeys:e=>Reflect.ownKeys(e),getOwnPropertyDescriptor:(e,t)=>Reflect.getOwnPropertyDescriptor(e,t)});return u.set(e,o),l.set(o,e),o},S=e=>{const t=new o;let r=!1;const n=new Set,s=()=>{r&&(r=!1,0!==n.size&&(t.emitChange(Array.from(n)),n.clear()))},f=h({},e=>{var t;(((e,t)=>{for(const r of e)if(c(r,t))return;for(const r of Array.from(e))c(t,r)&&e.delete(r);e.add(t)})(n,e),r)||(r=!0,t=s,"function"==typeof queueMicrotask?queueMicrotask(t):Promise.resolve().then(t))});Object.defineProperties(f,{[R]:{value:e=>t.subscribe(e),enumerable:!1,configurable:!1,writable:!1}});const a=e(f);if(!i(a)||Array.isArray(a))throw new Error("createStore(factory) must return an object");return Object.assign(f,a)},v="production"===process.env.NODE_ENV?e=>e:e=>t=>{{const r=new Proxy(t,{set:(e,t,r)=>{const n={...e},o=Reflect.set(e,t,r),s={...e};return console.groupCollapsed(`%cState change: ${String(t)}`,"color: #4cafef; font-weight: bold;"),console.log("%cPrev:","color: gray",n),console.log("%cNext:","color: green",s),console.groupEnd(),o}}),n=e(r),o={};for(const e in n){const t=n[e];o[e]="function"==typeof t?(...r)=>{console.groupCollapsed(`%c[authStore] Action: ${e}`,"color: #f0e68c; font-weight: bold;"),console.log("%cArgs:","color: #4cafef",r);const o=t.apply(n,r);return console.groupEnd(),o}:t}return o}},A=Symbol.for("@@laguz/is_proxy"),E=Symbol.for("@@laguz/raw"),R=Symbol.for("@@laguz/subscribe");export{A as IS_PROXY,E as RAW,R as SUBSCRIBE,a as createGlobalStore,S as createStore,v as withDebug};
